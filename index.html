<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>INKSPIRE | Printing Shop Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <style>
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
      from {opacity: 0}
      to {opacity: 1}
    }
    .status-select {
      padding: 4px;
      border-radius: 4px;
    }
  </style>
</head>
<body class="bg-gray-100 text-slate-900 dark:bg-slate-900 dark:text-white">

<!-- 🔐 LOGIN SCREEN -->
<div id="login-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-600 to-purple-600">
  <div class="bg-white dark:bg-slate-800 p-8 rounded shadow-lg w-full max-w-sm text-center">
    <h2 class="text-2xl font-bold text-indigo-600 dark:text-white mb-6">INKSPIRE Login</h2>
    <input type="text" id="login-username" placeholder="Username" class="w-full mb-4 px-4 py-2 border rounded" />
    <input type="password" id="login-password" placeholder="Password" class="w-full mb-4 px-4 py-2 border rounded" />
    <button onclick="handleLogin()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded">Login</button>
    <p id="login-error" class="text-red-500 mt-3 hidden">Invalid credentials</p>
  </div>
</div>

<!-- 🌐 MAIN APPLICATION WRAPPER -->
<div id="main-wrapper" class="hidden">
      <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-white dark:bg-slate-800 shadow-lg p-6">
      <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-300 mb-6">INKSPIRE</div>
      <nav class="space-y-2">
        <button onclick="showSection('dashboard')" class="block w-full text-left hover:text-indigo-600">📊 Dashboard</button>
        <button onclick="showSection('job-order')" class="block w-full text-left hover:text-indigo-600">📝 New Job Order</button>
        <button onclick="showSection('calendar')" class="block w-full text-left hover:text-indigo-600">📅 Calendar</button>
        <button onclick="showSection('tasks')" class="block w-full text-left hover:text-indigo-600">✅ Tasks</button>
        <button onclick="showSection('earnings')" class="block w-full text-left hover:text-indigo-600">💰 Earnings</button>
        <button onclick="showSection('expenses')" class="block w-full text-left hover:text-indigo-600">💸 Expenses</button>
        <button onclick="showSection('inventory')" class="block w-full text-left hover:text-indigo-600">📦 Inventory</button>
        <button onclick="showSection('reports')" class="block w-full text-left hover:text-indigo-600">📈 Reports</button>
      </nav>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-6 space-y-10 overflow-y-auto">
              <!-- Dashboard -->
      <section id="dashboard" class="fade-in">
        <h2 class="text-2xl font-semibold text-indigo-600 mb-4">📊 Dashboard</h2>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">Total Jobs</p>
            <h3 class="text-2xl font-bold text-indigo-600" id="stat-total">0</h3>
          </div>
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">In Progress</p>
            <h3 class="text-2xl font-bold text-yellow-500" id="stat-progress">0</h3>
          </div>
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">Completed</p>
            <h3 class="text-2xl font-bold text-green-500" id="stat-completed">0</h3>
          </div>
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">Cancelled</p>
            <h3 class="text-2xl font-bold text-red-500" id="stat-cancelled">0</h3>
          </div>
        </div>
      </section>

      <!-- New Job Order -->
      <section id="job-order" class="hidden fade-in">
        <h2 class="text-2xl font-bold text-indigo-600 mb-4">📝 New Job Order</h2>
        <form id="job-form" class="space-y-4">
          <input id="customer" type="text" required placeholder="Customer Name" class="w-full px-4 py-2 border rounded" />
          <input id="customer-phone" type="text" required placeholder="Phone Number" class="w-full px-4 py-2 border rounded" />

          <fieldset class="border p-4 rounded">
            <legend class="font-semibold text-gray-700 mb-2">Job Details</legend>
            <div class="grid grid-cols-3 gap-2">
              <label><input type="checkbox" name="details" value="Scanning" /> Scanning</label>
              <label><input type="checkbox" name="details" value="Laminating" /> Laminating</label>
              <label><input type="checkbox" name="details" value="Fax" /> Fax</label>
              <label><input type="checkbox" name="details" value="Photocopy" /> Photocopy</label>
              <label><input type="checkbox" name="details" value="Business Card" /> Business Card</label>
              <label><input type="checkbox" name="details" value="Mug Printing" /> Mug Printing</label>
              <label><input type="checkbox" name="details" value="Colour Printing" /> Colour Printing</label>
              <label><input type="checkbox" name="details" value="B&W Printing" /> B&W Printing</label>
              <label><input type="checkbox" name="details" value="Other" /> Other</label>
            </div>
            <textarea id="other-details" placeholder="Other Job Details" class="w-full mt-2 px-3 py-2 border rounded"></textarea>
          </fieldset>
                    <div class="grid grid-cols-2 gap-4">
            <input id="price" type="number" required placeholder="Price (Rs)" class="px-4 py-2 border rounded" />
            <input id="discount" type="number" required placeholder="Discount (Rs)" class="px-4 py-2 border rounded" />
          </div>

          <p class="text-red-600 font-semibold">Total: <span id="total-display">Rs. 0.00</span></p>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block mb-1 font-semibold">Order Date</label>
              <input id="order-date" type="date" class="w-full px-4 py-2 border rounded" />
            </div>
            <div>
              <label class="block mb-1 font-semibold">Deadline</label>
              <input id="deadline" type="date" required class="w-full px-4 py-2 border rounded" />
            </div>
          </div>

          <fieldset class="border p-4 rounded">
            <legend class="font-semibold text-gray-700">Delivery Method</legend>
            <label><input type="radio" name="delivery" value="address" onchange="toggleDeliveryFields(this.value)"> Deliver to Address</label><br>
            <label><input type="radio" name="delivery" value="email" onchange="toggleDeliveryFields(this.value)"> Email</label><br>
            <label><input type="radio" name="delivery" value="whatsapp" onchange="toggleDeliveryFields(this.value)"> WhatsApp</label>

            <div id="delivery-address" class="mt-2 hidden">
              <input type="text" id="delivery-address" placeholder="Enter Address" class="w-full px-3 py-2 border rounded" />
            </div>
            <div id="delivery-email" class="mt-2 hidden">
              <input type="email" id="delivery-email" placeholder="Enter Email" class="w-full px-3 py-2 border rounded" />
            </div>
            <div id="delivery-whatsapp" class="mt-2 hidden">
              <input type="text" id="delivery-whatsapp" placeholder="WhatsApp Number" class="w-full px-3 py-2 border rounded" />
            </div>
          </fieldset>

          <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 rounded">
            Submit Job
          </button>
        </form>
      </section>
            <!-- Calendar Section -->
      <section id="calendar" class="hidden fade-in">
        <h2 class="text-xl font-semibold text-indigo-600 mb-4">📅 Calendar</h2>
        <div id="calendarEl" class="bg-white rounded p-4 shadow"></div>
      </section>

      <!-- Tasks Section -->
      <section id="tasks" class="hidden fade-in">
        <h2 class="text-xl font-semibold text-indigo-600 mb-4">✅ Tasks</h2>
        <div class="overflow-x-auto bg-white rounded shadow">
          <table class="w-full text-sm text-left">
            <thead class="bg-slate-100 text-slate-800">
              <tr>
                <th class="px-4 py-2 border">Customer</th>
                <th class="px-4 py-2 border">Phone</th>
                <th class="px-4 py-2 border">Contact</th>
                <th class="px-4 py-2 border">Details</th>
                <th class="px-4 py-2 border">Price</th>
                <th class="px-4 py-2 border">Discount</th>
                <th class="px-4 py-2 border">Deadline</th>
                <th class="px-4 py-2 border">Status</th>
                <th class="px-4 py-2 border">Invoice</th>
              </tr>
            </thead>
            <tbody id="tasks-body">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </section>
            <!-- Earnings -->
      <section id="earnings" class="hidden fade-in">
        <h2 class="text-xl font-semibold text-indigo-600 mb-4">💰 Earnings</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">Income</p>
            <h3 class="text-2xl font-bold text-green-500" id="income-total">Rs. 0.00</h3>
          </div>
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">Expenses</p>
            <h3 class="text-2xl font-bold text-red-500" id="expense-total">Rs. 0.00</h3>
          </div>
          <div class="bg-white p-4 rounded shadow text-center">
            <p class="text-sm text-gray-400">Profit</p>
            <h3 class="text-2xl font-bold text-blue-500" id="profit-total">Rs. 0.00</h3>
          </div>
        </div>
      </section>

      <!-- Expenses -->
      <section id="expenses" class="hidden fade-in">
        <h2 class="text-xl font-semibold text-indigo-600 mb-4">💸 Expenses</h2>
        <form id="expense-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <input type="text" id="expense-title" placeholder="Title" class="px-3 py-2 border rounded" />
          <input type="number" id="expense-amount" placeholder="Amount" class="px-3 py-2 border rounded" />
          <input type="date" id="expense-date" class="px-3 py-2 border rounded" />
          <button type="submit" class="bg-indigo-600 text-white py-2 rounded col-span-full">Add Expense</button>
        </form>
        <table class="w-full text-sm bg-white rounded shadow">
          <thead class="bg-slate-100 text-gray-700">
            <tr>
              <th class="px-4 py-2 border">Title</th>
              <th class="px-4 py-2 border">Amount</th>
              <th class="px-4 py-2 border">Date</th>
            </tr>
          </thead>
          <tbody id="expense-body"></tbody>
        </table>
      </section>

      <!-- Inventory -->
      <section id="inventory" class="hidden fade-in">
        <h2 class="text-xl font-semibold text-indigo-600 mb-4">📦 Inventory</h2>
        <form id="inventory-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
          <input type="text" id="inv-name" placeholder="Item Name" class="px-3 py-2 border rounded" />
          <input type="number" id="inv-qty" placeholder="Quantity" class="px-3 py-2 border rounded" />
          <button type="submit" class="bg-indigo-600 text-white py-2 rounded">Add Item</button>
        </form>
        <table class="w-full text-sm bg-white rounded shadow">
          <thead class="bg-slate-100 text-gray-700">
            <tr>
              <th class="px-4 py-2 border">Item</th>
              <th class="px-4 py-2 border">Quantity</th>
            </tr>
          </thead>
          <tbody id="inventory-body"></tbody>
        </table>
      </section>

      <!-- Reports -->
      <section id="reports" class="hidden fade-in">
        <h2 class="text-xl font-semibold text-indigo-600 mb-4">📈 Reports</h2>
        <div class="flex flex-wrap items-center gap-4 mb-4">
          <div class="flex items-center gap-2">
            <label class="text-sm font-semibold">From:</label>
            <input type="date" id="report-from" class="px-2 py-1 border rounded" />
          </div>
          <div class="flex items-center gap-2">
            <label class="text-sm font-semibold">To:</label>
            <input type="date" id="report-to" class="px-2 py-1 border rounded" />
          </div>
          <button onclick="filterReportByDate()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">Filter</button>
          <button onclick="clearReportFilter()" class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-2 rounded">Reset</button>
        </div>
        <div class="overflow-x-auto bg-white rounded shadow">
          <table class="w-full text-sm text-left" id="report-table">
            <thead class="bg-slate-100 text-gray-800 cursor-pointer">
              <tr>
                <th class="px-4 py-2 border" onclick="sortReport('type')">Type ⬍</th>
                <th class="px-4 py-2 border" onclick="sortReport('title')">Title ⬍</th>
                <th class="px-4 py-2 border" onclick="sortReport('amount')">Amount ⬍</th>
                <th class="px-4 py-2 border" onclick="sortReport('date')">Date ⬍</th>
              </tr>
            </thead>
            <tbody id="report-body"></tbody>
          </table>
        </div>
      </section>

    </main>
  </div>
</div>
<script>
  const users = {
    "Insaf": "INSAF03",
    "Inzi": "INZI01",
    "Iltizam": "ILTIZAM05"
  };

  function loginUser() {
    const username = document.getElementById("login-username").value.trim();
    const password = document.getElementById("login-password").value.trim();
    if (users[username] && users[username] === password) {
      document.getElementById("login-screen").classList.add("hidden");
      document.getElementById("main-wrapper").classList.remove("hidden");
    } else {
      alert("Invalid credentials. Please try again.");
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("login-submit").addEventListener("click", loginUser);
    document.getElementById("login-password").addEventListener("keydown", e => {
      if (e.key === "Enter") loginUser();
    });

    // Set today's date as default for job order
    const today = new Date().toISOString().split("T")[0];
    document.getElementById("order-date").value = today;
    document.getElementById("expense-date").value = today;

    // Initialize FullCalendar
    const calendar = new FullCalendar.Calendar(document.getElementById("calendarEl"), {
      initialView: "dayGridMonth",
      height: 600,
      eventDidMount(info) {
        const deadline = new Date(info.event.start);
        const now = new Date();
        const diff = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
        if (diff <= 2) {
          info.el.style.backgroundColor = '#fecaca';
        } else if (diff <= 5) {
          info.el.style.backgroundColor = '#fde68a';
        } else {
          info.el.style.backgroundColor = '#bbf7d0';
        }
      }
    });
    calendar.render();

    // Handle section navigation
    window.showSection = function(id) {
      document.querySelectorAll("main > section").forEach(s => s.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if (id === "calendar") calendar.render();
    };

    // Total calculation
    document.getElementById("price").addEventListener("input", updateTotal);
    document.getElementById("discount").addEventListener("input", updateTotal);
    function updateTotal() {
      const price = parseFloat(document.getElementById("price").value) || 0;
      const discount = parseFloat(document.getElementById("discount").value) || 0;
      document.getElementById("total-display").textContent = `Rs. ${(price - discount).toFixed(2)}`;
    }

    // Delivery toggle
    window.toggleDeliveryFields = function(type) {
      document.getElementById("delivery-address").classList.add("hidden");
      document.getElementById("delivery-email").classList.add("hidden");
      document.getElementById("delivery-whatsapp").classList.add("hidden");
      if (type === "address") document.getElementById("delivery-address").classList.remove("hidden");
      if (type === "email") document.getElementById("delivery-email").classList.remove("hidden");
      if (type === "whatsapp") document.getElementById("delivery-whatsapp").classList.remove("hidden");
    };

    // Placeholder for rest of the logic
    // (Job handling, expenses, reports, etc.)

  });
</script>
<script>
  let jobData = [], expenseData = [], stats = { total: 0, in_progress: 0, completed: 0, cancelled: 0 };
  let totalIncome = 0, totalExpenses = 0;

  document.getElementById("job-form").addEventListener("submit", function (e) {
    e.preventDefault();

    const customer = document.getElementById("customer").value;
    const phone = document.getElementById("customer-phone").value;
    const price = parseFloat(document.getElementById("price").value) || 0;
    const discount = parseFloat(document.getElementById("discount").value) || 0;
    const orderDate = document.getElementById("order-date").value;
    const deadline = document.getElementById("deadline").value;

    const details = [...document.querySelectorAll('input[name="details"]:checked')].map(d => d.value);
    const other = document.getElementById("other-details").value;
    const fullDetails = [...details, other ? `Other: ${other}` : ''].filter(Boolean).join(", ");

    const deliveryType = document.querySelector('input[name="delivery"]:checked')?.value;
    let contact = "";
    if (deliveryType === "email") contact = document.getElementById("delivery-email").value;
    else if (deliveryType === "whatsapp") contact = document.getElementById("delivery-whatsapp").value;
    else if (deliveryType === "address") contact = document.getElementById("delivery-address").value;

    const job = {
      customer, phone, contact, details: fullDetails, price, discount,
      orderDate, deadline, status: "in_progress", incomeCounted: true
    };
    jobData.push(job);

    const calendar = FullCalendar.getCalendar(document.getElementById("calendarEl"));
    calendar.addEvent({ title: customer, start: deadline, allDay: true });

    stats.total++; stats.in_progress++;
    totalIncome += (price - discount);
    updateDashboard();
    renderTasks();

    this.reset();
    document.getElementById("order-date").value = new Date().toISOString().split("T")[0];
    document.getElementById("total-display").textContent = "Rs. 0.00";
  });

  function updateStatus(select) {
    const row = select.closest("tr");
    const index = [...document.querySelectorAll("#tasks-body select")].indexOf(select);
    const job = jobData[index];
    const prev = job.status;
    job.status = select.value;

    row.className = job.status === "completed"
      ? "bg-green-100"
      : job.status === "cancelled"
      ? "bg-red-100"
      : "bg-yellow-100";

    if (prev !== "cancelled" && job.status === "cancelled" && job.incomeCounted) {
      totalIncome -= (job.price - job.discount);
      job.incomeCounted = false;
    }

    if (prev === "cancelled" && job.status !== "cancelled" && !job.incomeCounted) {
      totalIncome += (job.price - job.discount);
      job.incomeCounted = true;
    }

    stats.in_progress = stats.completed = stats.cancelled = 0;
    jobData.forEach(j => stats[j.status]++);
    updateDashboard();
    renderTasks();
  }

  function renderTasks() {
    const tbody = document.getElementById("tasks-body");
    tbody.innerHTML = "";
    const now = new Date();
    jobData.forEach(job => {
      const age = (now - new Date(job.deadline)) / (1000 * 60 * 60 * 24);
      if (job.status === "completed" && age > 15) return;

      const tr = document.createElement("tr");
      tr.className = job.status === "completed"
        ? "bg-green-100"
        : job.status === "cancelled"
        ? "bg-red-100"
        : "bg-yellow-100";

      tr.innerHTML = `
        <td class="px-4 py-2 border">${job.customer}</td>
        <td class="px-4 py-2 border">${job.phone}</td>
        <td class="px-4 py-2 border">${job.contact}</td>
        <td class="px-4 py-2 border">${job.details}</td>
        <td class="px-4 py-2 border">${job.price}</td>
        <td class="px-4 py-2 border">${job.discount}</td>
        <td class="px-4 py-2 border">${job.deadline}</td>
        <td class="px-4 py-2 border">
          <select onchange="updateStatus(this)">
            <option value="in_progress" ${job.status === "in_progress" ? "selected" : ""}>In Progress</option>
            <option value="completed" ${job.status === "completed" ? "selected" : ""}>Completed</option>
            <option value="cancelled" ${job.status === "cancelled" ? "selected" : ""}>Cancelled</option>
          </select>
        </td>
        <td class="px-4 py-2 border"><button class="text-blue-600">Print</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  function updateDashboard() {
    document.getElementById('stat-total').textContent = stats.total;
    document.getElementById('stat-progress').textContent = stats.in_progress;
    document.getElementById('stat-completed').textContent = stats.completed;
    document.getElementById('stat-cancelled').textContent = stats.cancelled;
    document.getElementById('income-total').textContent = `Rs. ${totalIncome.toFixed(2)}`;
    document.getElementById('expense-total').textContent = `Rs. ${totalExpenses.toFixed(2)}`;
    document.getElementById('profit-total').textContent = `Rs. ${(totalIncome - totalExpenses).toFixed(2)}`;
  }
</script>