<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>INKSPIRE | Printing Shop Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .hidden { display: none; }
    .active { font-weight: bold; }
  </style>
</head>
<body class="bg-gray-100 text-gray-900">

<!-- Login Screen -->
<div id="login-screen" class="flex items-center justify-center h-screen bg-purple-600">
  <div class="bg-white p-8 rounded shadow-md w-full max-w-sm">
    <h2 class="text-2xl font-bold text-center text-purple-700 mb-6">INKSPIRE Login</h2>
    <input id="username" type="text" placeholder="Username" class="w-full px-4 py-2 border mb-3 rounded"/>
    <input id="password" type="password" placeholder="Password" class="w-full px-4 py-2 border mb-3 rounded"/>
    <button onclick="login()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 rounded">Login</button>
    <p id="login-error" class="text-red-500 mt-4 text-center hidden">Invalid credentials. Try again.</p>
  </div>
</div>

<!-- Main App -->
<div id="app" class="hidden flex h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg p-6 space-y-4">
    <div class="text-2xl font-bold text-purple-700 mb-4">INKSPIRE</div>
    <nav class="sidebar space-y-2">
      <button onclick="showSection('dashboard')" id="dashboard-link" class="block text-left w-full">📊 Dashboard</button>
      <button onclick="showSection('job-order')" class="block text-left w-full">📝 New Job Order</button>
      <button onclick="showSection('calendar')" class="block text-left w-full">📅 Calendar</button>
      <button onclick="showSection('tasks')" class="block text-left w-full">✅ Tasks</button>
      <button onclick="showSection('earnings')" class="block text-left w-full">💰 Earnings</button>
      <button onclick="showSection('expenses')" class="block text-left w-full">💸 Expenses</button>
      <button onclick="showSection('reports')" class="block text-left w-full">📈 Reports</button>
      <button onclick="logout()" class="block text-left w-full text-red-600">🚪 Logout</button>
    </nav>
  </aside>

  <!-- Content Area -->
  <main class="flex-1 p-6 space-y-10 overflow-y-auto">
    <!-- Dashboard Section -->
    <section id="dashboard" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">📊 Dashboard</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
        <div class="bg-white p-4 shadow rounded text-center">
          <p>Total Jobs</p><h3 class="text-2xl font-bold" id="stat-total">0</h3>
        </div>
        <div class="bg-white p-4 shadow rounded text-center">
          <p>In Progress</p><h3 class="text-2xl font-bold text-yellow-500" id="stat-progress">0</h3>
        </div>
        <div class="bg-white p-4 shadow rounded text-center">
          <p>Completed</p><h3 class="text-2xl font-bold text-green-500" id="stat-completed">0</h3>
        </div>
        <div class="bg-white p-4 shadow rounded text-center">
          <p>Cancelled</p><h3 class="text-2xl font-bold text-red-500" id="stat-cancelled">0</h3>
        </div>
      </div>
    </section>
    
        <!-- Job Order Section -->
    <section id="job-order" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">📝 New Job Order</h2>
      <form id="job-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <input id="customer" type="text" required placeholder="Customer Name" class="p-2 border rounded" />
        <input id="customer-phone" type="text" required placeholder="Phone Number" class="p-2 border rounded" />

        <fieldset class="md:col-span-2 border p-4 rounded">
          <legend class="font-semibold mb-2">Job Details</legend>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
            <label><input type="checkbox" name="details" value="Scanning"> Scanning</label>
            <label><input type="checkbox" name="details" value="Laminating"> Laminating</label>
            <label><input type="checkbox" name="details" value="Fax"> Fax</label>
            <label><input type="checkbox" name="details" value="Photocopy"> Photocopy</label>
            <label><input type="checkbox" name="details" value="Business Card"> Business Card</label>
            <label><input type="checkbox" name="details" value="Colour Printing"> Colour Printing</label>
            <label><input type="checkbox" name="details" value="B&W Printing"> B&W Printing</label>
            <label><input type="checkbox" name="details" value="Other"> Other</label>
          </div>
          <textarea id="other-details" placeholder="Other details..." class="w-full mt-2 p-2 border rounded"></textarea>
        </fieldset>

        <input id="price" type="number" required placeholder="Price (Rs)" class="p-2 border rounded" />
        <input id="discount" type="number" required placeholder="Discount (Rs)" class="p-2 border rounded" />
        <p class="md:col-span-2 font-semibold text-purple-700">Total: <span id="total-display">Rs. 0.00</span></p>

        <input id="order-date" type="date" class="p-2 border rounded" />
        <input id="deadline" type="date" required class="p-2 border rounded" />

        <fieldset class="md:col-span-2 border p-4 rounded">
          <legend class="font-semibold mb-2">Delivery</legend>
          <label><input type="radio" name="delivery" value="address" onchange="toggleDeliveryFields(this.value)"> Address</label>
          <label><input type="radio" name="delivery" value="email" onchange="toggleDeliveryFields(this.value)"> Email</label>
          <label><input type="radio" name="delivery" value="whatsapp" onchange="toggleDeliveryFields(this.value)"> WhatsApp</label>

          <div id="delivery-address" class="hidden mt-2">
            <input type="text" placeholder="Enter Address" class="w-full p-2 border rounded" />
          </div>
          <div id="delivery-email" class="hidden mt-2">
            <input type="email" placeholder="Enter Email" class="w-full p-2 border rounded" />
          </div>
          <div id="delivery-whatsapp" class="hidden mt-2">
            <input type="text" placeholder="WhatsApp Number" class="w-full p-2 border rounded" />
          </div>
        </fieldset>

        <button type="submit" class="md:col-span-2 bg-purple-600 hover:bg-purple-700 text-white py-2 rounded">Submit Job</button>
      </form>
    </section>

    <!-- Tasks Section -->
    <section id="tasks" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">✅ Tasks</h2>
      <div class="overflow-x-auto mt-4">
        <table class="w-full bg-white shadow rounded text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="border p-2">Customer</th>
              <th class="border p-2">Phone</th>
              <th class="border p-2">Contact</th>
              <th class="border p-2">Details</th>
              <th class="border p-2">Price</th>
              <th class="border p-2">Discount</th>
              <th class="border p-2">Deadline</th>
              <th class="border p-2">Status</th>
              <th class="border p-2">Invoice</th>
            </tr>
          </thead>
          <tbody id="tasks-body">
            <!-- Filled via JS -->
          </tbody>
        </table>
      </div>
    </section>
    
        <!-- Calendar Section -->
    <section id="calendar" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">📅 Calendar</h2>
      <div id="calendarEl" class="mt-4 bg-white p-4 rounded shadow"></div>
    </section>

    <!-- Earnings Section -->
    <section id="earnings" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">💰 Earnings</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
        <div class="bg-white p-4 rounded shadow text-center">
          <p class="text-gray-500 text-sm">Income</p>
          <h3 class="text-2xl font-bold text-green-600" id="income-total">Rs. 0.00</h3>
        </div>
        <div class="bg-white p-4 rounded shadow text-center">
          <p class="text-gray-500 text-sm">Expenses</p>
          <h3 class="text-2xl font-bold text-red-600" id="expense-total">Rs. 0.00</h3>
        </div>
        <div class="bg-white p-4 rounded shadow text-center">
          <p class="text-gray-500 text-sm">Profit</p>
          <h3 class="text-2xl font-bold text-blue-600" id="profit-total">Rs. 0.00</h3>
        </div>
      </div>
    </section>

    <!-- Expenses Section -->
    <section id="expenses" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">💸 Expenses</h2>
      <form id="expense-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4 mb-4">
        <input type="text" id="expense-title" placeholder="Title" class="p-2 border rounded"/>
        <input type="number" id="expense-amount" placeholder="Amount" class="p-2 border rounded"/>
        <input type="date" id="expense-date" class="p-2 border rounded"/>
        <button type="submit" class="md:col-span-3 bg-purple-600 text-white py-2 rounded">Add Expense</button>
      </form>
      <table class="w-full text-sm bg-white rounded shadow">
        <thead class="bg-gray-100">
          <tr>
            <th class="border p-2">Title</th>
            <th class="border p-2">Amount</th>
            <th class="border p-2">Date</th>
          </tr>
        </thead>
        <tbody id="expense-body">
          <!-- Filled via JS -->
        </tbody>
      </table>
    </section>

    <!-- Reports Section -->
    <section id="reports" class="hidden">
      <h2 class="text-xl font-semibold text-purple-700">📈 Reports</h2>
      <div class="flex flex-wrap gap-4 mt-4 mb-4">
        <div>
          <label class="text-sm font-semibold">From:</label>
          <input type="date" id="report-from" class="px-2 py-1 border rounded" />
        </div>
        <div>
          <label class="text-sm font-semibold">To:</label>
          <input type="date" id="report-to" class="px-2 py-1 border rounded" />
        </div>
        <button onclick="filterReportByDate()" class="bg-purple-600 text-white px-4 py-2 rounded">Filter</button>
        <button onclick="clearReportFilter()" class="bg-gray-400 text-white px-4 py-2 rounded">Reset</button>
      </div>
      <div class="overflow-x-auto bg-white rounded shadow">
        <table class="w-full text-sm" id="report-table">
          <thead class="bg-gray-100 cursor-pointer">
            <tr>
              <th class="border p-2" onclick="sortReport('type')">Type ⬍</th>
              <th class="border p-2" onclick="sortReport('title')">Title ⬍</th>
              <th class="border p-2" onclick="sortReport('amount')">Amount ⬍</th>
              <th class="border p-2" onclick="sortReport('date')">Date ⬍</th>
            </tr>
          </thead>
          <tbody id="report-body">
            <!-- Filled via JS -->
          </tbody>
        </table>
      </div>
    </section>
    
      </main>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script>
  const USERS = {
    "Insaf": "INSAF03",
    "Inzi": "INZI01",
    "Iltizam": "ILTIZAM05"
  };

  let jobData = [], expenseData = [], calendar;
  let stats = { total: 0, in_progress: 0, completed: 0, cancelled: 0 };
  let totalIncome = 0, totalExpenses = 0;

  function login() {
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    if (USERS[u] === p) {
      document.getElementById("login-screen").style.display = "none";
      document.getElementById("app").style.display = "flex";
      showSection("dashboard");
      setTimeout(initCalendar, 100);
    } else {
      document.getElementById("login-error").classList.remove("hidden");
    }
  }

  function logout() {
    document.getElementById("login-screen").style.display = "flex";
    document.getElementById("app").style.display = "none";
    document.getElementById("username").value = "";
    document.getElementById("password").value = "";
    document.getElementById("login-error").classList.add("hidden");
  }

  function showSection(id) {
    document.querySelectorAll("main > section").forEach(sec => sec.classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
    if (id === "calendar" && calendar) calendar.render();
    if (id === "tasks") updateTasks();
  }

  function initCalendar() {
    const el = document.getElementById("calendarEl");
    calendar = new FullCalendar.Calendar(el, {
      initialView: 'dayGridMonth',
      height: 600,
      eventDidMount(info) {
        const deadline = new Date(info.event.start);
        const now = new Date();
        const diff = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));
        if (diff <= 2) info.el.style.backgroundColor = '#fecaca';
        else if (diff <= 5) info.el.style.backgroundColor = '#fde68a';
        else info.el.style.backgroundColor = '#bbf7d0';
      }
    });
    calendar.render();
  }

  document.getElementById("job-form").addEventListener("submit", function (e) {
    e.preventDefault();
    const customer = document.getElementById("customer").value;
    const phone = document.getElementById("customer-phone").value;
    const price = parseFloat(document.getElementById("price").value) || 0;
    const discount = parseFloat(document.getElementById("discount").value) || 0;
    const orderDate = document.getElementById("order-date").value;
    const deadline = document.getElementById("deadline").value;

    const details = [...document.querySelectorAll('input[name="details"]:checked')].map(cb => cb.value);
    const other = document.getElementById("other-details").value;
    const fullDetails = [...details, other ? `Other: ${other}` : ''].filter(Boolean).join(", ");

    const delivery = document.querySelector('input[name="delivery"]:checked')?.value;
    let contact = "";
    if (delivery === "address") contact = document.querySelector("#delivery-address input").value;
    if (delivery === "email") contact = document.querySelector("#delivery-email input").value;
    if (delivery === "whatsapp") contact = document.querySelector("#delivery-whatsapp input").value;

    const job = { customer, phone, contact, details: fullDetails, price, discount, orderDate, deadline, status: "in_progress", incomeCounted: true };
    jobData.push(job);
    if (calendar) calendar.addEvent({ title: customer, start: deadline, allDay: true });

    stats.total++;
    stats.in_progress++;
    totalIncome += (price - discount);
    updateDashboard();
    updateTasks();
    updateReports();

    this.reset();
    document.getElementById("order-date").value = new Date().toISOString().split("T")[0];
    document.getElementById("total-display").textContent = "Rs. 0.00";
  });

  document.getElementById("price").addEventListener("input", updateTotal);
  document.getElementById("discount").addEventListener("input", updateTotal);
  function updateTotal() {
    const p = parseFloat(document.getElementById("price").value) || 0;
    const d = parseFloat(document.getElementById("discount").value) || 0;
    document.getElementById("total-display").textContent = `Rs. ${(p - d).toFixed(2)}`;
  }

  function toggleDeliveryFields(type) {
    document.getElementById("delivery-address").classList.add("hidden");
    document.getElementById("delivery-email").classList.add("hidden");
    document.getElementById("delivery-whatsapp").classList.add("hidden");
    if (type === "address") document.getElementById("delivery-address").classList.remove("hidden");
    if (type === "email") document.getElementById("delivery-email").classList.remove("hidden");
    if (type === "whatsapp") document.getElementById("delivery-whatsapp").classList.remove("hidden");
  }

  function updateTasks() {
    const tbody = document.getElementById("tasks-body");
    tbody.innerHTML = "";
    const now = new Date();
    stats.in_progress = stats.completed = stats.cancelled = 0;
    jobData.forEach((job, idx) => {
      const age = (now - new Date(job.deadline)) / (1000 * 60 * 60 * 24);
      if (job.status === "completed" && age > 15) return;

      stats[job.status]++;
      const row = document.createElement("tr");
      row.className = job.status === "completed" ? "bg-green-100" :
                      job.status === "cancelled" ? "bg-red-100" : "bg-yellow-100";
      row.innerHTML = `
        <td class="border p-2">${job.customer}</td>
        <td class="border p-2">${job.phone}</td>
        <td class="border p-2">${job.contact}</td>
        <td class="border p-2">${job.details}</td>
        <td class="border p-2">${job.price}</td>
        <td class="border p-2">${job.discount}</td>
        <td class="border p-2">${job.deadline}</td>
        <td class="border p-2">
          <select onchange="updateStatus(this, ${idx})">
            <option value="in_progress" ${job.status === "in_progress" ? "selected" : ""}>In Progress</option>
            <option value="completed" ${job.status === "completed" ? "selected" : ""}>Completed</option>
            <option value="cancelled" ${job.status === "cancelled" ? "selected" : ""}>Cancelled</option>
          </select>
        </td>
        <td class="border p-2"><button class="text-blue-600">Print</button></td>`;
      tbody.appendChild(row);
    });
    updateDashboard();
  }

  function updateStatus(select, idx) {
    const newStatus = select.value;
    const job = jobData[idx];
    const prev = job.status;
    job.status = newStatus;

    if (prev !== "cancelled" && newStatus === "cancelled" && job.incomeCounted) {
      totalIncome -= (job.price - job.discount);
      job.incomeCounted = false;
    }
    if (prev === "cancelled" && newStatus !== "cancelled" && !job.incomeCounted) {
      totalIncome += (job.price - job.discount);
      job.incomeCounted = true;
    }
    updateTasks();
    updateReports();
  }

  function updateDashboard() {
    document.getElementById("stat-total").textContent = stats.total;
    document.getElementById("stat-progress").textContent = stats.in_progress;
    document.getElementById("stat-completed").textContent = stats.completed;
    document.getElementById("stat-cancelled").textContent = stats.cancelled;
    document.getElementById("income-total").textContent = `Rs. ${totalIncome.toFixed(2)}`;
    document.getElementById("expense-total").textContent = `Rs. ${totalExpenses.toFixed(2)}`;
    document.getElementById("profit-total").textContent = `Rs. ${(totalIncome - totalExpenses).toFixed(2)}`;
  }

  document.getElementById("expense-form").addEventListener("submit", function (e) {
    e.preventDefault();
    const title = document.getElementById("expense-title").value;
    const amount = parseFloat(document.getElementById("expense-amount").value) || 0;
    const date = document.getElementById("expense-date").value;
    expenseData.push({ title, amount, date });
    totalExpenses += amount;
    updateDashboard();
    this.reset();
    document.getElementById("expense-date").value = new Date().toISOString().split("T")[0];
  });

  function updateReports() {
    const tbody = document.getElementById("report-body");
    tbody.innerHTML = "";
    jobData.forEach(j => {
      tbody.innerHTML += `<tr>
        <td class="border p-2">Income</td>
        <td class="border p-2">${j.customer}</td>
        <td class="border p-2">Rs. ${(j.price - j.discount).toFixed(2)}</td>
        <td class="border p-2">${j.orderDate}</td></tr>`;
    });
    expenseData.forEach(e => {
      tbody.innerHTML += `<tr>
        <td class="border p-2">Expense</td>
        <td class="border p-2">${e.title}</td>
        <td class="border p-2">Rs. ${e.amount.toFixed(2)}</td>
        <td class="border p-2">${e.date}</td></tr>`;
    });
  }

  function filterReportByDate() {
    const from = document.getElementById("report-from").value;
    const to = document.getElementById("report-to").value;
    const rows = document.querySelectorAll("#report-body tr");
    rows.forEach(row => {
      const date = row.children[3].textContent.trim();
      row.style.display = (!from || date >= from) && (!to || date <= to) ? "" : "none";
    });
  }

  function clearReportFilter() {
    document.getElementById("report-from").value = "";
    document.getElementById("report-to").value = "";
    document.querySelectorAll("#report-body tr").forEach(r => r.style.display = "");
  }

  let sortDirection = {};
  function sortReport(col) {
    const tbody = document.getElementById("report-body");
    const rows = Array.from(tbody.querySelectorAll("tr"));
    const index = { type: 0, title: 1, amount: 2, date: 3 }[col];
    const dir = sortDirection[col] = !sortDirection[col];
    rows.sort((a, b) => {
      const va = a.children[index].textContent.trim();
      const vb = b.children[index].textContent.trim();
      if (col === 'amount') return dir ? parseFloat(va.slice(3)) - parseFloat(vb.slice(3)) : parseFloat(vb.slice(3)) - parseFloat(va.slice(3));
      return dir ? va.localeCompare(vb) : vb.localeCompare(va);
    });
    rows.forEach(r => tbody.appendChild(r));
  }
</script>
</body>
</html>